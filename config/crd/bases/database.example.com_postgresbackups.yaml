apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: postgresbackups.database.example.com
  annotations:
    controller-gen.kubebuilder.io/version: v0.9.2
spec:
  group: database.example.com
  names:
    kind: PostgresBackup
    listKind: PostgresBackupList
    plural: postgresbackups
    singular: postgresbackup
    shortNames: ["pgb", "pgbackup"]
  scope: Namespaced
  versions:
  - name: v1
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        description: PostgresBackup is the Schema for the postgresbackups API
        properties:
          apiVersion:
            type: string
            description: 'APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          kind:
            type: string
            description: 'Kind is a string value representing the REST resource this object represents. Servers may infer this from the endpoint the client submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          metadata:
            type: object
          spec:
            type: object
            description: PostgresBackupSpec defines the desired state of PostgresBackup
            properties:
              clusterRef:
                type: object
                description: ClusterRef references the PostgresCluster to backup
                properties:
                  name:
                    type: string
                    description: Name of the cluster
                  namespace:
                    type: string
                    description: Namespace of the cluster
                required:
                - name
              type:
                type: string
                description: Type of backup (full, incremental, wal)
                enum: ["full", "incremental", "wal"]
                default: "full"
              storage:
                type: object
                description: Storage configuration for this backup
                properties:
                  storageClassName:
                    type: string
                    description: Storage class name for backup storage
                  size:
                    type: string
                    description: Size of storage for backup
                    pattern: '^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$'
                  s3:
                    type: object
                    description: S3 storage configuration
                    properties:
                      bucket:
                        type: string
                        description: S3 bucket name
                      region:
                        type: string
                        description: S3 region
                      endpoint:
                        type: string
                        description: S3 endpoint URL
                      path:
                        type: string
                        description: Path within the bucket
                      credentialsSecret:
                        type: object
                        description: Secret reference for S3 credentials
                        properties:
                          name:
                            type: string
                            description: Name of the secret
                          namespace:
                            type: string
                            description: Namespace of the secret
                        required:
                        - name
                    required:
                    - bucket
              retentionPolicy:
                type: object
                description: Retention policy for this backup
                properties:
                  keepLast:
                    type: integer
                    format: int32
                    description: KeepLast specifies how many most recent backups to keep
                    minimum: 0
                  keepDaily:
                    type: integer
                    format: int32
                    description: KeepDaily specifies how many daily backups to keep
                    minimum: 0
                  keepWeekly:
                    type: integer
                    format: int32
                    description: KeepWeekly specifies how many weekly backups to keep
                    minimum: 0
                  keepMonthly:
                    type: integer
                    format: int32
                    description: KeepMonthly specifies how many monthly backups to keep
                    minimum: 0
                  deleteOnClusterDeletion:
                    type: boolean
                    description: DeleteOnClusterDeletion determines if backup should be deleted when cluster is deleted
                    default: false
              options:
                type: object
                description: Options for the backup
                properties:
                  compression:
                    type: string
                    description: Compression type (gzip, lz4, none)
                    enum: ["gzip", "lz4", "none"]
                    default: "gzip"
                  encryption:
                    type: object
                    description: Encryption configuration
                    properties:
                      enabled:
                        type: boolean
                        description: Enabled indicates if encryption is enabled
                        default: false
                      secretRef:
                        type: object
                        description: SecretRef references the encryption key
                        properties:
                          name:
                            type: string
                            description: Name of the secret
                          namespace:
                            type: string
                            description: Namespace of the secret
                        required:
                        - name
                  parallelJobs:
                    type: integer
                    format: int32
                    description: Parallel jobs for backup
                    minimum: 1
                    maximum: 32
                    default: 1
                  timeout:
                    type: string
                    description: Timeout for backup operation
                    pattern: '^([0-9]+(\.[0-9]+)?(ns|us|Âµs|ms|s|m|h))+$'
                    default: "1h"
            required:
            - clusterRef
          status:
            type: object
            description: PostgresBackupStatus defines the observed state of PostgresBackup
            properties:
              phase:
                type: string
                description: Phase represents the current phase of the backup
                enum: ["Pending", "Running", "Completed", "Failed"]
              message:
                type: string
                description: Message provides additional information about the current state
              startTime:
                type: string
                format: date-time
                description: StartTime of the backup
              completionTime:
                type: string
                format: date-time
                description: CompletionTime of the backup
              size:
                type: integer
                format: int64
                description: Size of the backup in bytes
                minimum: 0
              location:
                type: string
                description: Location where the backup is stored
              conditions:
                type: array
                description: Conditions represent the latest available observations
                items:
                  type: object
                  properties:
                    type:
                      type: string
                      description: Type of condition
                    status:
                      type: string
                      description: Status of the condition
                      enum: ["True", "False", "Unknown"]
                    lastTransitionTime:
                      type: string
                      format: date-time
                      description: Last time the condition transitioned from one status to another
                    reason:
                      type: string
                      description: Unique, one-word, CamelCase reason for the condition's last transition
                    message:
                      type: string
                      description: Human-readable message indicating details about last transition
                  required:
                  - type
                  - status
                  - lastTransitionTime
              databaseVersion:
                type: string
                description: DatabaseVersion at the time of backup
              walStart:
                type: string
                description: WALStart position
              walEnd:
                type: string
                description: WALEnd position
              jobName:
                type: string
                description: JobName of the backup job
    subresources:
      status: {}
    additionalPrinterColumns:
    - name: Cluster
      type: string
      description: The cluster being backed up
      jsonPath: .spec.clusterRef.name
    - name: Type
      type: string
      description: Type of backup
      jsonPath: .spec.type
    - name: Phase
      type: string
      description: Current phase of the backup
      jsonPath: .status.phase
    - name: Size
      type: string
      description: Size of the backup
      jsonPath: .status.size
    - name: Age
      type: date
      description: Age of the backup
      jsonPath: .metadata.creationTimestamp